---
alwaysApply: true
description: 실행 환경 및 서버 실행 규칙
---

# Execution Environment

## Overview
프로젝트의 실행 환경 설정 및 서버 실행 규칙. Windows PowerShell 환경에서의 실행 방법과 스크립트 사용법을 정의합니다.

## Domain Knowledge

### 서버 실행 방법
- **백엔드**: FastAPI (uvicorn) 서버, 포트 8000
- **프론트엔드**: Next.js 개발 서버, 포트 3000
- **실행 위치**: 모든 명령어는 **프로젝트 루트**에서 실행해야 함

### 실행 스크립트
- `scripts/start-backend.ps1`: 백엔드 서버 실행 (PowerShell)
- `scripts/start-frontend.ps1`: 프론트엔드 서버 실행 (PowerShell)
- `scripts/start-all.ps1`: 두 서버 동시 실행 (PowerShell, 새 창)
- `scripts/start-all.bat`: 배치 파일 버전 (바로가기용)
- `scripts/create-shortcut.ps1`: 바로가기 생성 스크립트

## Standards & Conventions

### 1. 프로젝트 루트에서 실행 (필수)

**규칙**: 모든 명령어는 프로젝트 루트에서 실행해야 합니다.

```powershell
# ✅ 올바른 예시 (프로젝트 루트에서)
poetry run uvicorn backend.main:app --host 0.0.0.0 --port 8000
npm --prefix frontend run dev

# ❌ 잘못된 예시 (cd 사용 금지)
cd frontend
npm run dev  # ❌ 프로젝트 루트 규칙 위반!
```

**이유**:
- 프로젝트 구조가 프로젝트 루트를 기준으로 설계됨
- 상대 경로 참조가 프로젝트 루트 기준
- 스크립트들이 프로젝트 루트를 자동으로 찾도록 구현됨

### 2. 서버 실행 명령어

**백엔드 서버**:
```powershell
# Poetry 사용 (권장)
poetry run uvicorn backend.main:app --host 0.0.0.0 --port 8000 --reload

# 또는 스크립트 사용
.\scripts\start-backend.ps1
```

**프론트엔드 서버**:
```powershell
# npm 사용 (권장, 프로젝트 루트에서)
npm --prefix frontend run dev

# 또는 스크립트 사용
.\scripts\start-frontend.ps1
```

**두 서버 동시 실행**:
```powershell
# 스크립트 사용 (권장)
.\scripts\start-all.ps1

# 또는 배치 파일
.\scripts\start-all.bat
```

### 3. 스크립트 사용법

**실행 스크립트 특징**:
1. **자동 경로 확인**: 스크립트 실행 위치를 자동으로 프로젝트 루트로 변경
2. **포트 충돌 체크**: 8000, 3000 포트 사용 중인 프로세스 자동 종료
3. **환경 변수 확인**: `.env` 파일 존재 여부 확인
4. **의존성 확인**: Poetry, Node.js 설치 확인
5. **브라우저 자동 실행**: 서버 시작 후 5초 뒤 브라우저 자동 열기 (start-all.ps1)

**바로가기 생성**:
```powershell
# 바로가기 생성 (최초 1회)
.\scripts\create-shortcut.ps1

# 또는 배치 파일
.\scripts\create-shortcut.bat
```

생성된 `Start App.lnk` 파일을 더블클릭하여 앱을 시작할 수 있습니다.

### 4. 포트 충돌 해결

**자동 해결** (스크립트 사용 시):
- 스크립트는 자동으로 포트를 사용 중인 프로세스를 종료합니다.

**수동 해결**:
```powershell
# 포트 8000 사용 중인 프로세스 확인
netstat -ano | findstr :8000

# 프로세스 종료
taskkill /F /PID [PID번호]

# 포트 3000 사용 중인 프로세스 확인
netstat -ano | findstr :3000

# 프로세스 종료
taskkill /F /PID [PID번호]
```

**psutil 사용** (선택적, 테스트에서 사용):
```python
import psutil

for proc in psutil.process_iter(['pid', 'name', 'connections']):
    connections = proc.info.get('connections')
    if connections:
        for conn in connections:
            if conn.status == 'LISTEN' and conn.laddr.port == 8000:
                proc.terminate()
```

### 5. 환경 변수 설정

**.env 파일 위치**: 프로젝트 루트

**.env 파일 내용**:
```env
OPENAI_API_KEY=your-api-key-here
```

**파일 확인** (숨김 파일일 수 있음):
```powershell
Get-ChildItem -Name "*.env*" -Force
```

**주의**: `.env` 파일은 `.gitignore`에 포함되어 있어 Git에 커밋되지 않습니다.

### 6. PowerShell 실행 정책

**문제**: PowerShell 스크립트 실행이 차단될 수 있습니다.

**해결 방법**:
1. **현재 세션에서만 허용** (권장):
   ```powershell
   Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
   ```

2. **배치 파일 사용**: `.bat` 파일은 자동으로 실행 정책을 우회합니다.

3. **명령줄에서 직접 실행**:
   ```powershell
   powershell.exe -ExecutionPolicy Bypass -File .\scripts\start-all.ps1
   ```

### 7. 명령어 연결 규칙

**규칙**: PowerShell에서는 세미콜론(`;`)을 사용하여 명령어를 연결합니다.

```powershell
# ✅ 올바른 예시
cd /path/to/project; poetry run uvicorn backend.main:app --host 0.0.0.0 --port 8000

# ❌ 잘못된 예시 (Bash 스타일)
cd /path/to/project && poetry run uvicorn ...  # ❌ PowerShell에서는 && 사용 불가
```

**주의**: 프로젝트 루트에서 실행 규칙에 따라 `cd`는 사용하지 않는 것이 좋습니다.

## Implementation Patterns

### Pattern 1: 서버 실행 스크립트 구조

```powershell
# scripts/start-backend.ps1 예시 구조
$scriptDir = Split-Path -Parent $MyInvocation.MyCommand.Path
$projectRoot = Split-Path -Parent $scriptDir
Set-Location $projectRoot

# 포트 충돌 체크
$port = 8000
$processes = Get-NetTCPConnection -LocalPort $port -ErrorAction SilentlyContinue
if ($processes) {
    # 기존 프로세스 종료
    foreach ($proc in $processes) {
        Stop-Process -Id $proc.OwningProcess -Force -ErrorAction SilentlyContinue
    }
}

# 서버 실행
poetry run uvicorn backend.main:app --host 0.0.0.0 --port 8000 --reload
```

### Pattern 2: 새 창에서 서버 실행

```powershell
# scripts/start-all.ps1 예시
$backendScript = Join-Path $scriptDir "start-backend.ps1"
$frontendScript = Join-Path $scriptDir "start-frontend.ps1"

# 새 창에서 실행
Start-Process powershell.exe -ArgumentList "-NoExit", "-File", "`"$backendScript`"" -WorkingDirectory $projectRoot
Start-Process powershell.exe -ArgumentList "-NoExit", "-File", "`"$frontendScript`"" -WorkingDirectory $projectRoot
```

## Checklist

### 서버 실행 시
- [ ] 프로젝트 루트에서 실행 확인
- [ ] `.env` 파일 존재 확인 (OPENAI_API_KEY 설정)
- [ ] Poetry/Node.js 설치 확인
- [ ] 포트 충돌 확인 및 해결
- [ ] 스크립트 사용 시 PowerShell 실행 정책 확인

### 스크립트 작성 시
- [ ] 프로젝트 루트 자동 확인 로직 구현
- [ ] 포트 충돌 체크 및 자동 종료 로직 구현
- [ ] 환경 변수 확인 로직 구현
- [ ] 의존성 확인 로직 구현
- [ ] 에러 처리 구현

## References
- 프로젝트 루트 실행 규칙: `AGENTS.md`
- 실행 스크립트: `scripts/start-*.ps1`, `scripts/start-*.bat`
- README: `README.md` (실행 방법 섹션)
